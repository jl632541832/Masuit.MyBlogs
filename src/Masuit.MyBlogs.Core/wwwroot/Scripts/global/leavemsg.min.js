function submitComment(n){loading();window.post("/Msg/submit",$(n).serializeObject(),n=>{loadingDone(),n&&n.Success?(window.notie.alert({type:1,text:n.Message,time:4}),setTimeout(function(){getmsgs();$("[id^=LAY_layedit]").contents().find("body").html("")},100)):window.notie.alert({type:3,text:n.Message,time:4})})}function bindReplyBtn(){$(".msg-list article .panel-body a").on("click",function(n){n.preventDefault();loadingDone();var t=$(this).attr("href"),i=t.substring(t.indexOf("uid")+4);$("#uid").val(i);$("#OperatingSystem2").val(DeviceInfo.OS.toString());$("#Browser2").val(DeviceInfo.browserInfo.Name+" "+DeviceInfo.browserInfo.Version);layui.use("layer",function(){var n=layui.layer;n.open({type:1,zIndex:20,title:"回复留言",area:(window.screen.width>540?540:window.screen.width)+"px",content:$("#reply"),end:function(){$("#reply").css("display","none")}})});$(".layui-layer").insertBefore($(".layui-layer-shade"));window.currentEditor=layui.layedit.build("layedit2",{tool:["strong","italic","link","unlink","face"],height:100})})}function loadParentMsgs(n){var r,u;if(loading(),r="",n){var t=Enumerable.From(n.rows).Where(n=>n.ParentId===0).ToArray(),i=n.page,f=n.size,e=Math.ceil(n.total/f);i=i>e?e:i;i=i<1?1:i;u=n.parentTotal-(i-1)*f;for(let i=0;i<t.length;i++)r+=`<li class="msg-list media animated fadeInRight" id='${t[i].Id}'>
						   <div class="media-body">
								<article class="panel panel-info">
									<header class="panel-heading">${u}# ${t[i].IsMaster?`<i class="icon icon-user"></i>`:""}${t[i].NickName}${t[i].IsMaster?`(管理员)`:""} | ${t[i].PostDate}
										<span class="pull-right hidden-sm hidden-xs" style="font-size: 10px;">${GetOperatingSystem(t[i].OperatingSystem)+" | "+GetBrowser(t[i].Browser)}</span>
									</header>
									<div class="panel-body">
										${t[i].Content}
										<a class="label label-info" href="?uid=${t[i].Id}"><i class="icon-comment"></i></a>
										${loadMsgs(n.rows,Enumerable.From(n.rows).Where(n=>n.ParentId===t[i].Id).OrderBy(n=>n.PostDate).ToArray(),u--)}
									</div>
								</article>
							</div>
						</li>`}return loadingDone(),r}function loadMsgs(n,t,i,r=0){var f=["info","success","primary","warning","danger"],e=1,u;return r++,u="",Enumerable.From(t).ForEach(t=>{var o=f[r%5];u+=`<article id="${t.Id}" class="panel panel-${o}">
						<div class="panel-heading">
							${r}-${e++}# ${t.IsMaster?`<i class="icon icon-user"></i>`:""}${t.NickName}${t.IsMaster?`(管理员)`:""} | ${t.PostDate}<span class="pull-right hidden-sm hidden-xs" style="font-size: 10px;">${GetOperatingSystem(t.OperatingSystem)+" | "+GetBrowser(t.Browser)}
							</span>
						</div>
						<div class="panel-body">
							${t.Content}
							<a class="label label-${o}" href="?uid=${t.Id}"><i class="icon-comment"></i></a>
							${loadMsgs(n,Enumerable.From(n).Where(n=>n.ParentId===t.Id).OrderBy(n=>n.PostDate),i,r)}
						</div>
					</article>`}),u}$(function(){layui.use("layedit",function(){layui.layedit.build("layedit",{tool:["strong","italic","link","unlink","face"],height:150})});$("#OperatingSystem").val(DeviceInfo.OS.toString());$("#Browser").val(DeviceInfo.browserInfo.Name+" "+DeviceInfo.browserInfo.Version);window.getmsgs();$("#msg-form").on("submit",function(n){if(n.preventDefault(),layui.layedit.sync(1),$("#name").val().trim().length<=0||$("#name").val().trim().length>24){window.notie.alert({type:3,text:"昵称要求2-24个字符！",time:4});loadingDone();return}if(!/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test($("#email").val().trim())){window.notie.alert({type:3,text:"请输入正确的邮箱格式！",time:4});loadingDone();return}if($("#email").val().indexOf("163")>1||$("#email").val().indexOf("126")>1){var t=this;swal({title:"邮箱确认",text:"检测到您输入的邮箱是网易邮箱，本站的邮件服务器可能会因为您的反垃圾设置而无法将邮件正常发送到您的邮箱，建议使用您的其他邮箱，或者检查反垃圾设置后，再点击确定按钮继续！",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"确定",cancelButtonText:"换个邮箱",confirmButtonClass:"btn btn-success btn-lg",cancelButtonClass:"btn btn-danger btn-lg",buttonsStyling:!1}).then(function(n){n===!0&&submitComment(t)});return}if($("#layedit").val().trim().length<=2||$("#layedit").val().trim().length>1e3){window.notie.alert({type:3,text:"内容过短或者超长，请输入有效的留言内容！",time:4});loadingDone();return}submitComment(this)});$(".btn-cancel").click(function(){$(":input","#reply-form").not(":button,:submit,:reset,:hidden").val("").removeAttr("checked").removeAttr("checked");layer.closeAll();setTimeout(function(){$("#reply").css("display","none")},500)});$("#reply-form").on("submit",function(n){if(n.preventDefault(),layui.layedit.sync(window.currentEditor),$("#name2").val().trim().length<=0||$("#name").val().trim().length>24){window.notie.alert({type:3,text:"昵称要求2-24个字符！",time:4});loadingDone();return}if(!/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test($("#email2").val().trim())){window.notie.alert({type:3,text:"请输入正确的邮箱格式！",time:4});loadingDone();return}window.post("/Msg/submit",$(this).serializeObject(),n=>{loadingDone(),n&&n.Success?(window.notie.alert({type:1,text:n.Message,time:4}),layer.closeAll(),setTimeout(function(){window.getmsgs();$("#reply").css("display","none");$("[id^=LAY_layedit]").contents().find("body").html("")},500)):window.notie.alert({type:3,text:n.Message,time:4})})})});