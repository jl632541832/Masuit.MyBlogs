window.onload=function(){window.UE&&(window.ue=UE.getEditor("editor",{initialFrameWidth:null}));var n=JSON.parse(localStorage.getItem("user"));n&&($("[name='Author']").val(n.NickName),$("[name='Email']").val(n.Email));$(".ui.dropdown.tags").dropdown({allowAdditions:!0,maxSelections:5,message:{maxSelections:"最多选择 {maxCount} 项",noResults:"无搜索结果！"}});$(".ui.dropdown.category").dropdown({message:{maxSelections:"最多选择 {maxCount} 项",noResults:"无搜索结果！"}});$(".ui.dropdown.category").dropdown("set selected",1);$("#submit").on("click",function(n){if(n.preventDefault(),loading(),$("#article").val().trim().length<=2||$("#article").val().trim().length>128){window.notie.alert({type:3,text:"文章标题必须在2到128个字符以内！",time:4});loadingDone();return}if($("#Author").val().trim().length<=1||$("#Author").val().trim().length>24){window.notie.alert({type:3,text:"昵称不能少于2个字符或超过36个字符！",time:4});loadingDone();return}if(!/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test($("#Email").val().trim())){window.notie.alert({type:3,text:"请输入正确的邮箱格式！",time:4});loadingDone();return}if(ue.getContent().length<20||ue.getContent().length>1e6){window.notie.alert({type:3,text:"文章内容过短或者超长的，请修改后再提交！",time:4});loadingDone();return}window.post("/Post/Publish",$("#article-form").serializeObject(),n=>{loadingDone(),n.Success?(window.notie.alert({type:1,text:n.Message,time:4}),$(":input","#article-form").not(":button,:submit,:reset,:hidden").val("").removeAttr("checked").removeAttr("checked"),ue.setContent(""),clearInterval(window.interval),localStorage.removeItem("write-post-draft")):window.notie.alert({type:3,text:n.Message,time:4})})});$("#getcode").on("click",function(t){t.preventDefault();window.post("/validate/sendcode",{__RequestVerificationToken:$("[name=__RequestVerificationToken]").val(),email:$("#Email").val()},function(t){if(t.Success){layer.tips("验证码发送成功，请注意查收邮件，若未收到，请检查你的邮箱地址或邮件垃圾箱！","#getcode",{tips:[1,"#3595CC"],time:4e3});n.NickName=$("[name='NickName']").val();n.Email=$("[name='Email']").val();localStorage.setItem("user",JSON.stringify(n));$("#getcode").attr("disabled",!0);var i=0,r=setInterval(function(){i++;$("#getcode").text("重新发送("+(120-i)+")");i>120&&(clearInterval(r),$("#getcode").attr("disabled",!1),$("#getcode").text("重新发送"))},1e3)}else layer.tips(t.Message,"#getcode",{tips:[1,"#3595CC"],time:4e3})})});$("#search").on("click",function(n){n.preventDefault();window.open("/s?wd="+$("#article").val())});localStorage.getItem("write-post-draft")?notie.confirm({text:"检查到上次有未提交的草稿，是否加载？",submitText:"确定",cancelText:"取消",position:"bottom",submitCallback:function(){var n=JSON.parse(localStorage.getItem("write-post-draft"));$("#article").val(n.Title);ue.setContent(n.Content);$(".ui.dropdown.category").dropdown("set selected",[n.CategoryId]);n.Label&&$(".ui.dropdown.tags").dropdown("set selected",n.Label.split(","));$("[name='Author']").val(n.Author);$("[name='Email']").val(n.Email);window.interval=setInterval(function(){localStorage.setItem("write-post-draft",JSON.stringify($("#article-form").serializeObject()))},5e3)},cancelCallback:function(){window.interval=setInterval(function(){localStorage.setItem("write-post-draft",JSON.stringify($("#article-form").serializeObject()))},5e3)}}):window.interval=setInterval(function(){localStorage.setItem("write-post-draft",JSON.stringify($("#article-form").serializeObject()))},5e3)};